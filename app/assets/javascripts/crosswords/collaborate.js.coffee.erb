#= require pusher

jQuery ->
  pusher = new Pusher('<%= Pusher.key %>')
  channel = pusher.subscribe 'private-' + $('#crossword').data('id')

  container = $('#crossword')
  container.bind 'crossword:word-selected', (_, data) ->
    channel.trigger 'client-word-selected', data
  container.bind 'crossword:new-letter', (_, data) ->
    channel.trigger 'client-new-letter', data
  container.bind 'crossword:remove-letter', (_, data) ->
    channel.trigger 'client-remove-letter', data

  channel.bind 'client-word-selected', (data) ->
    row = parseInt(data.row, 10)
    col = parseInt(data.col, 10)
    window.crossword.update_highlighting 'selected2', row, col, data.direction

  channel.bind 'client-new-letter', (data) ->
    row = parseInt(data.row, 10)
    col = parseInt(data.col, 10)
    window.crossword.insert_character data.letter, row, col, false

  channel.bind 'client-remove-letter', (data) ->
    row = parseInt(data.row, 10)
    col = parseInt(data.col, 10)
    window.crossword.backspace row, col, false
